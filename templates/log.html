$def with ()

$var title: Log
$var page: log
$code:
    def formatTime(t):
        if options.time_format:
            return t
        else:
            hour = int(t[0:2])
            newhour = hour
            if hour == 0:
                newhour = 12
            if hour > 12:
                newhour = hour-12
            return str(newhour)  + t[2:] + (" am" if hour<12 else " pm")


<script>
    // Initialize behaviors
    jQuery(document).ready(function(){
        jQuery("button#nRefresh").click(function(){
            window.location="/log";
        });
        jQuery("button#nDeleteAll").click(function(){
            jQuery("form#clearForm").submit();
        });
    });

</script>

<div id="options">
    <div class="title">Log ${"Enabled" if options.run_log else "Disabled"}</div>
    <form method="post" action="/log" name="clearForm" id="clearForm">
        <input type="hidden" name="clear" value="1"/>
    </form>
</div>

<div id="log">
    $ records = log.finished_runs()
    <p>Total number of records: ${len(records)} (${"no" if options.run_entries==0 else options.run_entries} limit)</p>
    <p>Download log as <a href="/wl">csv</a>.</p>

    <table class="logList">
        <tr class="log_rec">
            <th>Date</th>
            <th>Start Time</th>
            <th>Station</th>
            <th>Duration</th>
            <th>Program</th>
        </tr>
        $for interval in reversed(records):
            $ duration = (interval['end'] - interval['start']).total_seconds()
            $ minutes, seconds = divmod(duration, 60)
            <tr class="log_rec ${loop.parity}">
                <td align='center'>${interval["start"].strftime("%Y-%m-%d")}</td>
                <td align='center'>${formatTime(interval["start"].strftime("%H:%M:%S"))}</td>
                <td align='center'>${stations[interval["station"]].name}</td>
                <td align='center'>${"%02d:%02d" % (minutes, seconds)}</td>
                <td align='center'>${interval["program_name"]}</td>
            </tr>
    </table>

</div>

<div id="controls">
    <button id="nRefresh" class="refresh">Refresh</button>
    <button id="nDeleteAll" class="delete danger">Clear Log</button>
</div>
